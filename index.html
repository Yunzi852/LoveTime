import React, { useState, useEffect } from "react";
import { Moon, Sun } from "lucide-react";

const ElapsedTimer = () => {
  const [isDarkMode, setIsDarkMode] = useState(false);
  const [timeElapsed, setTimeElapsed] = useState(calculateTimeElapsed());
  const [stars, setStars] = useState([]);
  const [hearts, setHearts] = useState([]);

  function calculateTimeElapsed() {
    const targetDate = new Date("2025-05-31T12:29:00");
    const difference = new Date().getTime() - targetDate.getTime();

    if (difference <= 0) {
      return { days: 0, hours: 0, minutes: 0, seconds: 0 };
    }

    return {
      days: Math.floor(difference / (1000 * 60 * 60 * 24)),
      hours: Math.floor((difference / (1000 * 60 * 60)) % 24),
      minutes: Math.floor((difference / 1000 / 60) % 60),
      seconds: Math.floor((difference / 1000) % 60),
    };
  }

  useEffect(() => {
    const timer = setTimeout(() => {
      setTimeElapsed(calculateTimeElapsed());
    }, 1000);

    return () => clearTimeout(timer);
  });

  useEffect(() => {
    // 初始化星星
    const newStars = Array.from({ length: 50 }, () => ({
      id: Math.random(),
      x: Math.random() * 100,
      y: Math.random() * 100,
      size: Math.random() * 2 + 1,
      opacity: Math.random(),
    }));
    setStars(newStars);

    // 初始化爱心
    const newHearts = Array.from({ length: 10 }, () => ({
      id: Math.random(),
      x: Math.random() * 100,
      y: Math.random() * 100,
      size: Math.random() * 10 + 5,
      opacity: Math.random(),
      rotation: Math.random() * 360,
    }));
    setHearts(newHearts);
  }, []);

  const toggleDarkMode = () => {
    setIsDarkMode(!isDarkMode);
  };

  return (
<div className={`flex min-h-screen flex-col items-center justify-center ${isDarkMode ? "bg-black text-white" : "bg-gradient-to-br from-pink-100 to-purple-100 text-gray-800" } relative overflow-hidden`}>
    {/* 背景元素 */}
    {isDarkMode ? (
    <>
    {stars.map((star) => (
    <div key={star.id}
         className="absolute rounded-full bg-white"
         style={{
                left: `${star.x}%`,
                top: `${star.y}%`,
                width: `${star.size}px`,
                height: `${star.size}px`,
                opacity: star.opacity + 0.5,
                animation: `twinkle ${Math.random() * 3 + 2}s infinite`,
              }} />
    ))}
    </>
    ) : (
    <>
    {hearts.map((heart) => (
    <div key={heart.id}
         className="absolute animate-pulse"
         style={{
                left: `${heart.x}%`,
                top: `${heart.y}%`,
                width: `${heart.size}px`,
                height: `${heart.size}px`,
                opacity: heart.opacity,
                transform: `rotate(${heart.rotation}deg)`,
                animation: `float ${Math.random() * 5 + 3}s ease-in-out infinite`,
              }}>
        <svg viewBox="0 0 24 24"
             fill="currentColor"
             className="text-pink-400"
             style={{
                  width: "100%",
                  height: "100%",
                }}>
            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
        </svg>
    </div>
    ))}
    </>
    )}

    {/* 计时显示 */}
    <div className="z-10 rounded-lg bg-black/30 p-8 text-center backdrop-blur-md md:p-12">
        <h1 className="mb-8 text-4xl font-bold md:text-6xl">
            距离2025年5月31日12:29已有
        </h1>
        <div className="flex flex-col items-center">
            <div className="mb-8 text-center">
                <span className="font-mono text-8xl font-bold">
                    {String(timeElapsed.days).padStart(2, "0")}:
                    {String(timeElapsed.hours).padStart(2, "0")}:
                    {String(timeElapsed.minutes).padStart(2, "0")}:
                    {String(timeElapsed.seconds).padStart(2, "0")}
                </span>
            </div>
            <div className="text-2xl text-gray-300">
                {timeElapsed.days}天 {timeElapsed.hours}小时 {timeElapsed.minutes}分钟 {timeElapsed.seconds}秒
            </div>
        </div>
    </div>

    {/* 主题切换按钮 */}
    <button onClick={toggleDarkMode}
            className="absolute right-4 top-4 rounded-full bg-white/10 p-2 backdrop-blur-md transition-colors hover:bg-white/20"
            aria-label="切换主题">
        {isDarkMode ? (
        <Sun className="size-6 text-yellow-400" />
        ) : (
        <Moon className="size-6 text-gray-800" />
        )}
    </button>

    <style jsx>
        {
            ` @keyframes twinkle

        {
            0%, 100%

        {
            opacity: $

        {
            Math .random() * 0.5 + 0.3
        }

        ;
        transform: scale(1);
        }

        50% {
            opacity: $

        {
            Math .random() * 0.5 + 0.8
        }

        ;
        transform: scale(1.5);
        }
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0) rotate(${Math.random() * 360}deg);
            }

            50% {
                transform: translateY(-20px) rotate(${Math.random() * 360}deg);
            }
        }

        `
        }
    </style>
</div>
  );
};

export default ElapsedTimer;